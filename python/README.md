# MCDC

**Modified Condition/Decision Coverage Library for Python**

This library computes the *Modified Condition/Decision Coverage* (MCDC) and *Branch Coverage* (BC) metrics for Coloured Petri Net (CPN) models. 
To this end, it parses instrumented log files generated by the CPN Tool [1].

[1] [CPN Tools] (http://cpntools.org/)

## Installation

This library requires Python 2.7.9 or Python 3.4+. 
You must compile and install the source code by yourself. 
To do so, then execute the following steps. 
The dependencies of the tool are listed in requirements.txt. 
You can run the following command for installing them:

$ pip install -r requirements.txt

Afterwards you need to run:

$ python setup.py build

$ python setup.py install

for installing the library. In order to run all the tests, you must execute:

$ python setup.py test

or

$ cd Tests

$ pytest

from the root of the project folder.


For users that donâ€™t have write permission to the global site-packages directory or 
do not want to install our library into it, Python enables the selection of the target 
installation folder with a simple option:

$ pip install -r requirements.txt --user

$ python setup.py build

$ python setup.py install --user

In Unix/Mac OS X environments:, the structure of the installation folders will be the following:

|Type of file |  Installation directory|
|------------ | --------------------------|
| modules | userbase/lib/pythonX.Y/site-packages |
| scripts | userbase/bin |
| data | userbase |
| C headers | userbase/include/pythonX.Y/distname |

And here are the values used on Windows:

| Type of file |  Installation directory |
|------------ | --------------------------|
| modules | userbase\PythonXY\site-packages |
| scripts | userbase\Scripts |
| data | userbase |
| C headers | userbase\PythonXY\Include\distname |

The advantage of using this scheme compared to the other ones described in [2] is that the 
user site-packages directory is under normal conditions always included in sys.path, which 
means that there is no additional step to perform after running the setup.py script to 
finalize the installation.

[2] Installing Python Modules (Legacy version) (https://docs.python.org/2/install/)

## Usage

The library consists of two classes, LogFile and MCDC_Table:
- LogFile reads the meaningful information from the log file, and feeds it to the MCDC_Table. Each line is in the format `<id>:<cond_1>...<cond_n>:<output>`, where `id` is the transition name, `cond_i` is each one of the Boolean values in the decision, and `output` is the evaluation result.
```
...
a3:01:0
t42:01110:0
Returna19:0001:0
...
```

- MCDC_Table is a class that wrappes the truth table resulting from the evaluation of Boolean expressions. It contains all the expressions that are evaluated for each `id`.
```
...
Returna19
0001    0
0010    0
0101    0
0110    0
1001    1
1101    1
1110    1
...
```

Once the reading of the LogFile is completed, the user can compute coverage metrics by asking to the MCDC_Table.
Code in doc/demo.py shows how to read a logfile, create truth tables, print them and analyze the MC/DC results.

```
$ python doc/demo.py execution_trace.log
```

 The previous command parses the `execution_trace.log` file generated by the CPN Tool and calculates coverage information. It prints individual reports in the form of the truth tables for each decision, which summarises the conditions that are fired during the execution of the CPN model.   
In the case that the decision is not MC/DC covered, the Python script points out the remaining valuations of the truth tables that should be evaluated in order to fulfil this criteria. 

In the example below, the first condition (left-most column in the table) has multiple complementary entries where the expression only varies in one bit (e.g., rows 0001 and 1001) and the output changes (0 to 1). The R set shows three such pairs for condition 1, but no complementary entries at all are found in the truth table for conditions 2, 3 and 4, and hence indicated as empty sets [] by Python.

```
...
Returna19
0001    0
0010    0
0101    0
0110    0
1001    1
1101    1
1110    1
...
MCDC covered? False
R {1: [(0001, 1001), (0101, 1101), (0110, 1110)], 2: [], 3: [], 4: []}
```

Additionally, code in doc/report.py writes a more exhaustive report.

```
$ python doc/report.py execution_trace.log gnu_plot.data (num_PN_transitions)
```
It process the `execution_trace.log` file and reports the percentage of transitions in the Petri net that satisfy the MC/DC and branch coverage criteria  (i.e., longer CPN simulations may produce higher coverage rates). 

 The output file is in the GNU Plot format, so that it can be later easily plotted by running the following command:

 ```
 plot "gnu_plot.data" using 1:2 title 'MCDC' with lines,\
     "gnu_plot.data" using 1:3 title 'BC' with lines
```

The report.py script requires to know the number of transitions in the CPN model for computing the percentage of transitions that satisfy the MC/DC and branch coverage criteria, and the script infers the value from the logfile. The user can choose to explicitly specify the number of transitions in the CPN model through the optional parameter `num_PN_transitions`